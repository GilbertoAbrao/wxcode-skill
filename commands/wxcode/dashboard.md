---
name: wxcode:dashboard
description: Generate project progress JSON and notify watchers
allowed-tools:
  - Bash
  - mcp__wxcode-kb__*
---

<objective>

Generate comprehensive JSON snapshots of project progress for external UI rendering.

**Usage:**
- `/wxcode:dashboard` — Regenerate project dashboard only
- `/wxcode:dashboard --all` — Regenerate project + ALL milestone dashboards

**Two Dashboard Types:**

1. **Project Dashboard** (`.planning/dashboard.json`)
   - Global view of all milestones
   - Conversion progress from MCP
   - Created/updated by this command

2. **Milestone Dashboard** (`.planning/dashboard_<milestone>.json`)
   - Detailed phases, plans, tasks for ONE milestone
   - Workflow stages tracking
   - Created/updated by milestone-specific commands OR `--all` flag

**Output:**
1. Writes JSON to `.planning/dashboard.json`
2. With `--all`: Also writes each `.planning/dashboard_<milestone>.json`
3. Emits watcher notification for each updated file

**Use case:** IDE integrations, dashboards, progress visualization, file watchers, recovery after desync

</objective>

<execution_context>
@~/.claude/get-shit-done/references/dashboard-schema-project.md
@~/.claude/get-shit-done/references/dashboard-schema-milestone.md
</execution_context>

<structured_output>
## Structured Output (MANDATORY)

**At command start:**
```
<!-- WXCODE:HEADER:{"command":"dashboard","args":"$ARGUMENTS","title":"WXCODE ▶ GENERATING DASHBOARD"} -->
```

**On status changes:**
```
<!-- WXCODE:STATUS:{"status":"in_progress","message":"[current step]","progress":[0-100]} -->
```

**At command end:**
```
<!-- WXCODE:NEXT_ACTION:{"command":"progress","args":"","description":"Check project progress","priority":"recommended"} -->
```
</structured_output>



<process>

## Step 1: Parse Arguments

```bash
REGEN_ALL=""
[[ "$ARGUMENTS" == *"--all"* ]] && REGEN_ALL="--all"
```

## Step 2: Run Dashboard Generator Script

The dashboard is generated by a deterministic Python script:

```bash
python3 ~/.claude/get-shit-done/bin/generate-dashboard.py $REGEN_ALL --project-dir .
```

This script:
- Parses `.planning/` files (ROADMAP.md, REQUIREMENTS.md, STATE.md)
- Finds PLAN.md files in `phases/` directories
- Extracts tasks from XML `<task>` blocks
- Generates proper nested JSON structure with `phases[].plans[].tasks[]`
- Outputs notification for each file updated

## Step 3: Enrich with MCP Data (Conversion Projects Only)

For conversion projects, enrich the project dashboard with MCP data:

```bash
# Check if conversion project
if [ -f .planning/CONVERSION.md ]; then
  # Get conversion stats from MCP
  # mcp__wxcode-kb__get_conversion_stats(project_name=PROJECT_NAME)
  # Update dashboard.json with elements_converted and elements_total
fi
```

**Use MCP to get:**
- `elements_converted` — count of converted elements
- `elements_total` — total elements to convert

Update `.planning/dashboard.json` with these values in the `conversion` object.

## Step 4: Display Summary

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 WXCODE ► DASHBOARDS REGENERATED
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

| Dashboard | Status |
|-----------|--------|
| Project | ✓ .planning/dashboard.json |
| v1.0-PAGE_Login | ✓ .planning/dashboard_v1.0-PAGE_Login.json |

Total: [N] dashboards updated
```

</process>

<success_criteria>

- [ ] Python script executed successfully
- [ ] Project dashboard JSON is valid
- [ ] Written to `.planning/dashboard.json`
- [ ] Notification emitted for each file

**With --all:**
- [ ] All milestone dashboards regenerated
- [ ] Phases have nested `plans[]` arrays
- [ ] Plans have nested `tasks[]` arrays
- [ ] Progress calculated correctly
- [ ] Notification emitted for each dashboard

</success_criteria>

<troubleshooting>

**If script fails:**

1. Check Python 3 is available: `python3 --version`
2. Check script exists: `ls ~/.claude/get-shit-done/bin/generate-dashboard.py`
3. Check .planning/ structure exists

**If tasks are empty:**

1. Check PLAN.md files use XML format: `<task><name>...</name></task>`
2. Check file naming: `01-01-PLAN.md` (not `1.1-PLAN.md`)
3. Check phases directory: `.planning/phases/01-*/`

</troubleshooting>

<integration>

## When to Use --all

Use `/wxcode:dashboard --all` when:
- Dashboards are out of sync with actual files
- After manual edits to planning docs
- After schema migration
- For troubleshooting/recovery
- After git operations that modified .planning/

## Automatic Updates

Other commands should call the script after state changes:

```bash
python3 ~/.claude/get-shit-done/bin/generate-dashboard.py --all --project-dir .
```

</integration>
